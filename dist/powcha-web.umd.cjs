(function(U,Z){typeof exports=="object"&&typeof module<"u"?Z(exports):typeof define=="function"&&define.amd?define(["exports"],Z):(U=typeof globalThis<"u"?globalThis:U||self,Z(U.powcha={}))})(this,function(U){"use strict";var cn=Object.defineProperty;var an=(U,Z,ne)=>Z in U?cn(U,Z,{enumerable:!0,configurable:!0,writable:!0,value:ne}):U[Z]=ne;var H=(U,Z,ne)=>an(U,typeof Z!="symbol"?Z+"":Z,ne);const Z="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IGY9bmV3IFRleHRFbmNvZGVyO2Z1bmN0aW9uIGQoZSl7cmV0dXJuWy4uLm5ldyBVaW50OEFycmF5KGUpXS5tYXAodD0+dC50b1N0cmluZygxNikucGFkU3RhcnQoMiwiMCIpKS5qb2luKCIiKX1hc3luYyBmdW5jdGlvbiBwKGUsdCxvKXtyZXR1cm4gZChhd2FpdCBjcnlwdG8uc3VidGxlLmRpZ2VzdChvLnRvVXBwZXJDYXNlKCksZi5lbmNvZGUoZSt0KSkpfWZ1bmN0aW9uIGcoZSx0LG89IlNIQS0yNTYiLGw9MWU2LGM9MCl7Y29uc3QgYT1uZXcgQWJvcnRDb250cm9sbGVyLGk9RGF0ZS5ub3coKTtyZXR1cm57cHJvbWlzZTooYXN5bmMoKT0+e2ZvcihsZXQgbj1jO248PWw7bis9MSl7aWYoYS5zaWduYWwuYWJvcnRlZClyZXR1cm4gbnVsbDtpZihhd2FpdCBwKHQsbixvKT09PWUpcmV0dXJue251bWJlcjpuLHRvb2s6RGF0ZS5ub3coKS1pfX1yZXR1cm4gbnVsbH0pKCksY29udHJvbGxlcjphfX1sZXQgcjtvbm1lc3NhZ2U9YXN5bmMgZT0+e2NvbnN0e3R5cGU6dCxwYXlsb2FkOm99PWUuZGF0YTtpZih0PT09ImFib3J0IilyPT1udWxsfHxyLmFib3J0KCkscj12b2lkIDA7ZWxzZSBpZih0PT09IndvcmsiKXtjb25zdHthbGc6bCxjaGFsbGVuZ2U6YyxtYXg6YSxzYWx0Omksc3RhcnQ6dX09b3x8e30sbj1nKGMsaSxsLGEsdSk7cj1uLmNvbnRyb2xsZXIsbi5wcm9taXNlLnRoZW4ocz0+e3NlbGYucG9zdE1lc3NhZ2UocyYmey4uLnMsd29ya2VyOiEwfSl9KX19fSkoKTsK",ne=n=>Uint8Array.from(atob(n),e=>e.charCodeAt(0)),Ne=typeof window<"u"&&window.Blob&&new Blob([ne(Z)],{type:"text/javascript;charset=utf-8"});function dt(n){let e;try{if(e=Ne&&(window.URL||window.webkitURL).createObjectURL(Ne),!e)throw"";const t=new Worker(e,{name:n==null?void 0:n.name});return t.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;base64,"+Z,{name:n==null?void 0:n.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}function re(){}function je(n){return n()}function Te(){return Object.create(null)}function fe(n){n.forEach(je)}function Me(n){return typeof n=="function"}function ht(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function mt(n){return Object.keys(n).length===0}function k(n,e){n.appendChild(e)}function gt(n,e,t){const i=bt(n);if(!i.getElementById(e)){const o=R("style");o.id=e,o.textContent=t,wt(i,o)}}function bt(n){if(!n)return document;const e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function wt(n,e){return k(n.head||n,e),e.sheet}function W(n,e,t){n.insertBefore(e,t||null)}function M(n){n.parentNode&&n.parentNode.removeChild(n)}function R(n){return document.createElement(n)}function z(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function pt(n){return document.createTextNode(n)}function B(){return pt(" ")}function ke(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function f(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function vt(n){return Array.from(n.childNodes)}function Ze(n,e,t){n.classList.toggle(e,!!t)}function yt(n,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:i})}function _t(n){const e={};return n.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}let ce;function ae(n){ce=n}function xe(){if(!ce)throw new Error("Function called outside component initialization");return ce}function kt(n){xe().$$.on_mount.push(n)}function xt(n){xe().$$.on_destroy.push(n)}function Et(){const n=xe();return(e,t,{cancelable:i=!1}={})=>{const o=n.$$.callbacks[e];if(o){const l=yt(e,t,{cancelable:i});return o.slice().forEach(s=>{s.call(n,l)}),!l.defaultPrevented}return!0}}const ie=[],me=[];let oe=[];const We=[],De=Promise.resolve();let Ee=!1;function Pe(){Ee||(Ee=!0,De.then(p))}function Lt(){return Pe(),De}function Le(n){oe.push(n)}const Ce=new Set;let le=0;function p(){if(le!==0)return;const n=ce;do{try{for(;le<ie.length;){const e=ie[le];le++,ae(e),Ct(e.$$)}}catch(e){throw ie.length=0,le=0,e}for(ae(null),ie.length=0,le=0;me.length;)me.pop()();for(let e=0;e<oe.length;e+=1){const t=oe[e];Ce.has(t)||(Ce.add(t),t())}oe.length=0}while(ie.length);for(;We.length;)We.pop()();Ee=!1,Ce.clear(),ae(n)}function Ct(n){if(n.fragment!==null){n.update(),fe(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Le)}}function Rt(n){const e=[],t=[];oe.forEach(i=>n.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),oe=e}const It=new Set;function St(n,e){n&&n.i&&(It.delete(n),n.i(e))}function At(n,e,t){const{fragment:i,after_update:o}=n.$$;i&&i.m(e,t),Le(()=>{const l=n.$$.on_mount.map(je).filter(Me);n.$$.on_destroy?n.$$.on_destroy.push(...l):fe(l),n.$$.on_mount=[]}),o.forEach(Le)}function Nt(n,e){const t=n.$$;t.fragment!==null&&(Rt(t.after_update),fe(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function jt(n,e){n.$$.dirty[0]===-1&&(ie.push(n),Pe(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Tt(n,e,t,i,o,l,s=null,a=[-1]){const u=ce;ae(n);const d=n.$$={fragment:null,ctx:[],props:l,update:re,not_equal:o,bound:Te(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Te(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};s&&s(d.root);let $=!1;if(d.ctx=t?t(n,e.props||{},(j,V,..._)=>{const G=_.length?_[0]:V;return d.ctx&&o(d.ctx[j],d.ctx[j]=G)&&(!d.skip_bound&&d.bound[j]&&d.bound[j](G),$&&jt(n,j)),V}):[],d.update(),$=!0,fe(d.before_update),d.fragment=i?i(d.ctx):!1,e.target){if(e.hydrate){const j=vt(e.target);d.fragment&&d.fragment.l(j),j.forEach(M)}else d.fragment&&d.fragment.c();e.intro&&St(n.$$.fragment),At(n,e.target,e.anchor),p()}ae(u)}let Ve;typeof HTMLElement=="function"&&(Ve=class extends HTMLElement{constructor(e,t,i){super();H(this,"$$ctor");H(this,"$$s");H(this,"$$c");H(this,"$$cn",!1);H(this,"$$d",{});H(this,"$$r",!1);H(this,"$$p_d",{});H(this,"$$l",{});H(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,i&&this.attachShadow({mode:"open"})}addEventListener(e,t,i){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){const o=this.$$c.$on(e,t);this.$$l_u.set(t,o)}super.addEventListener(e,t,i)}removeEventListener(e,t,i){if(super.removeEventListener(e,t,i),this.$$c){const o=this.$$l_u.get(t);o&&(o(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(l){return()=>{let s;return{c:function(){s=R("slot"),l!=="default"&&f(s,"name",l)},m:function(d,$){W(d,s,$)},d:function(d){d&&M(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;const t={},i=_t(this);for(const l of this.$$s)l in i&&(t[l]=[e(l)]);for(const l of this.attributes){const s=this.$$g_p(l.name);s in this.$$d||(this.$$d[s]=ge(s,l.value,this.$$p_d,"toProp"))}for(const l in this.$$p_d)!(l in this.$$d)&&this[l]!==void 0&&(this.$$d[l]=this[l],delete this[l]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});const o=()=>{this.$$r=!0;for(const l in this.$$p_d)if(this.$$d[l]=this.$$c.$$.ctx[this.$$c.$$.props[l]],this.$$p_d[l].reflect){const s=ge(l,this.$$d[l],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[l].attribute||l):this.setAttribute(this.$$p_d[l].attribute||l,s)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(const l in this.$$l)for(const s of this.$$l[l]){const a=this.$$c.$on(l,s);this.$$l_u.set(s,a)}this.$$l={}}}attributeChangedCallback(e,t,i){var o;this.$$r||(e=this.$$g_p(e),this.$$d[e]=ge(e,i,this.$$p_d,"toProp"),(o=this.$$c)==null||o.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function ge(n,e,t,i){var l;const o=(l=t[n])==null?void 0:l.type;if(e=o==="Boolean"&&typeof e!="boolean"?e!=null:e,!i||!t[n])return e;if(i==="toAttribute")switch(o){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(o){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}function Mt(n,e,t,i,o,l){let s=class extends Ve{constructor(){super(n,t,o),this.$$p_d=e}static get observedAttributes(){return Object.keys(e).map(a=>(e[a].attribute||a).toLowerCase())}};return Object.keys(e).forEach(a=>{Object.defineProperty(s.prototype,a,{get(){return this.$$c&&a in this.$$c?this.$$c[a]:this.$$d[a]},set(u){var d;u=ge(a,u,e),this.$$d[a]=u,(d=this.$$c)==null||d.$set({[a]:u})}})}),i.forEach(a=>{Object.defineProperty(s.prototype,a,{get(){var u;return(u=this.$$c)==null?void 0:u[a]}})}),l&&(s=l(s)),n.element=s,s}class Zt{constructor(){H(this,"$$");H(this,"$$set")}$destroy(){Nt(this,1),this.$destroy=re}$on(e,t){if(!Me(t))return re;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}$set(e){this.$$set&&!mt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Wt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Wt);const Dt=new TextEncoder;function Pt(n){return[...new Uint8Array(n)].map(e=>e.toString(16).padStart(2,"0")).join("")}async function Vt(n,e="SHA-256",t=1e5){const i=Date.now().toString(16);n||(n=Math.round(Math.random()*t));const o=await Fe(i,n,e);return{algorithm:e,challenge:o,salt:i,signature:""}}async function Fe(n,e,t){return Pt(await crypto.subtle.digest(t.toUpperCase(),Dt.encode(n+e)))}function Ft(n,e,t="SHA-256",i=1e6,o=0){const l=new AbortController,s=Date.now();return{promise:(async()=>{for(let u=o;u<=i;u+=1){if(l.signal.aborted)return null;if(await Fe(e,u,t)===n)return{number:u,took:Date.now()-s}}return null})(),controller:l}}var g=(n=>(n.ERROR="error",n.VERIFIED="verified",n.VERIFYING="verifying",n.UNVERIFIED="unverified",n.EXPIRED="expired",n))(g||{});function Ut(n){gt(n,"svelte-1ffb04m",'.powcha.svelte-1ffb04m.svelte-1ffb04m{background:var(--powcha-color-base, transparent);border:var(--powcha-border-width, 1px) solid var(--powcha-color-border, #a0a0a0);border-radius:var(--powcha-border-radius, 3px);color:var(--powcha-color-text, currentColor);display:flex;flex-direction:column;max-width:var(--powcha-max-width, 260px);position:relative;text-align:left}.powcha.svelte-1ffb04m.svelte-1ffb04m:focus-within{border-color:var(--powcha-color-border-focus, currentColor)}.powcha[data-floating].svelte-1ffb04m.svelte-1ffb04m{background:var(--powcha-color-base, white);display:none;filter:drop-shadow(3px 3px 6px rgba(0, 0, 0, 0.2));left:-100%;position:fixed;top:-100%;width:var(--powcha-max-width, 260px);z-index:999999}.powcha[data-floating=top].svelte-1ffb04m .powcha-anchor-arrow.svelte-1ffb04m{border-bottom-color:transparent;border-top-color:var(--powcha-color-border, #a0a0a0);bottom:-12px;top:auto}.powcha[data-floating=bottom].svelte-1ffb04m.svelte-1ffb04m:focus-within::after{border-bottom-color:var(--powcha-color-border-focus, currentColor)}.powcha[data-floating=top].svelte-1ffb04m.svelte-1ffb04m:focus-within::after{border-top-color:var(--powcha-color-border-focus, currentColor)}.powcha[data-floating].svelte-1ffb04m.svelte-1ffb04m:not([data-state=unverified]){display:block}.powcha-anchor-arrow.svelte-1ffb04m.svelte-1ffb04m{border:6px solid transparent;border-bottom-color:var(--powcha-color-border, #a0a0a0);content:"";height:0;left:12px;position:absolute;top:-12px;width:0}.powcha-main.svelte-1ffb04m.svelte-1ffb04m{align-items:center;display:flex;gap:0.4rem;padding:0.7rem}.powcha-label.svelte-1ffb04m.svelte-1ffb04m{flex-grow:1}.powcha-label.svelte-1ffb04m label.svelte-1ffb04m{cursor:pointer}.powcha-brand.svelte-1ffb04m.svelte-1ffb04m{display:flex;align-items:center;height:24px;width:24px}.powcha-logo.svelte-1ffb04m.svelte-1ffb04m{color:currentColor;opacity:0.3}.powcha-logo.svelte-1ffb04m.svelte-1ffb04m:hover{opacity:1}.powcha-error.svelte-1ffb04m.svelte-1ffb04m{color:var(--powcha-color-error-text, #f23939);display:flex;font-size:0.85rem;gap:0.3rem;padding:0 0.7rem 0.7rem}.powcha-footer.svelte-1ffb04m.svelte-1ffb04m{align-items:center;background-color:var(--powcha-color-footer-bg, transparent);display:flex;font-size:0.75rem;opacity:0.4;padding:0.2rem 0.7rem;text-align:right}.powcha-footer.svelte-1ffb04m.svelte-1ffb04m:hover{opacity:1}.powcha-footer.svelte-1ffb04m>.svelte-1ffb04m:first-child{flex-grow:1}.powcha-footer.svelte-1ffb04m a{color:currentColor}.powcha-checkbox.svelte-1ffb04m.svelte-1ffb04m{display:flex;align-items:center;height:24px;width:24px}.powcha-checkbox.svelte-1ffb04m input.svelte-1ffb04m{width:18px;height:18px;margin:0}.powcha-hidden.svelte-1ffb04m.svelte-1ffb04m{display:none}.powcha-spinner.svelte-1ffb04m.svelte-1ffb04m{animation:svelte-1ffb04m-powcha-spinner 0.75s infinite linear;transform-origin:center}@keyframes svelte-1ffb04m-powcha-spinner{100%{transform:rotate(360deg)}}')}function Ue(n){let e,t,i;return{c(){e=z("svg"),t=z("path"),i=z("path"),f(t,"d","M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z"),f(t,"fill","currentColor"),f(t,"opacity",".25"),f(i,"d","M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z"),f(i,"fill","currentColor"),f(i,"class","powcha-spinner svelte-1ffb04m"),f(e,"width","24"),f(e,"height","24"),f(e,"viewBox","0 0 24 24"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(o,l){W(o,e,l),k(e,t),k(e,i)},d(o){o&&M(e)}}}function $t(n){let e,t=n[12].label+"",i;return{c(){e=R("label"),f(e,"for",i=n[4]+"_checkbox"),f(e,"class","svelte-1ffb04m")},m(o,l){W(o,e,l),e.innerHTML=t},p(o,l){l[0]&4096&&t!==(t=o[12].label+"")&&(e.innerHTML=t),l[0]&16&&i!==(i=o[4]+"_checkbox")&&f(e,"for",i)},d(o){o&&M(e)}}}function Gt(n){let e,t=n[12].verifying+"";return{c(){e=R("span")},m(i,o){W(i,e,o),e.innerHTML=t},p(i,o){o[0]&4096&&t!==(t=i[12].verifying+"")&&(e.innerHTML=t)},d(i){i&&M(e)}}}function Ht(n){let e,t=n[12].verified+"",i,o;return{c(){e=R("span"),i=B(),o=R("input"),f(o,"type","hidden"),f(o,"name",n[5]),o.value=n[6]},m(l,s){W(l,e,s),e.innerHTML=t,W(l,i,s),W(l,o,s)},p(l,s){s[0]&4096&&t!==(t=l[12].verified+"")&&(e.innerHTML=t),s[0]&32&&f(o,"name",l[5]),s[0]&64&&(o.value=l[6])},d(l){l&&(M(e),M(i),M(o))}}}function $e(n){let e,t,i,o,l;return{c(){e=R("div"),t=R("a"),i=z("svg"),o=z("path"),f(o,"d","M 12 2 C 6.486 2 2 6.486 2 12 C 2 17.514 6.486 22 12 22 C 17.514 22 22 17.514 22 12 C 22 10.874 21.803984 9.7942031 21.458984 8.7832031 L 19.839844 10.402344 C 19.944844 10.918344 20 11.453 20 12 C 20 16.411 16.411 20 12 20 C 7.589 20 4 16.411 4 12 C 4 7.589 7.589 4 12 4 C 13.633 4 15.151922 4.4938906 16.419922 5.3378906 L 17.851562 3.90625 C 16.203562 2.71225 14.185 2 12 2 z M 21.292969 3.2929688 L 11 13.585938 L 7.7070312 10.292969 L 6.2929688 11.707031 L 11 16.414062 L 22.707031 4.7070312 L 21.292969 3.2929688 z"),f(o,"fill","currentColor"),f(i,"width","24"),f(i,"height","24"),f(i,"viewBox","0 0 24 24"),f(i,"fill","none"),f(i,"xmlns","http://www.w3.org/2000/svg"),f(t,"href",Be),f(t,"target","_blank"),f(t,"class","powcha-logo svelte-1ffb04m"),f(t,"aria-label",l=n[12].ariaLinkLabel),f(e,"class","powcha-brand svelte-1ffb04m")},m(s,a){W(s,e,a),k(e,t),k(t,i),k(i,o)},p(s,a){a[0]&4096&&l!==(l=s[12].ariaLinkLabel)&&f(t,"aria-label",l)},d(s){s&&M(e)}}}function Ge(n){let e,t,i,o;function l(u,d){return u[7]===g.EXPIRED?Xt:Ot}let s=l(n),a=s(n);return{c(){e=R("div"),t=z("svg"),i=z("path"),o=B(),a.c(),f(i,"stroke-linecap","round"),f(i,"stroke-linejoin","round"),f(i,"d","M6 18L18 6M6 6l12 12"),f(t,"width","14"),f(t,"height","14"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width","1.5"),f(t,"stroke","currentColor"),f(e,"class","powcha-error svelte-1ffb04m")},m(u,d){W(u,e,d),k(e,t),k(t,i),k(e,o),a.m(e,null)},p(u,d){s===(s=l(u))&&a?a.p(u,d):(a.d(1),a=s(u),a&&(a.c(),a.m(e,null)))},d(u){u&&M(e),a.d()}}}function Ot(n){let e,t=n[12].error+"";return{c(){e=R("div"),f(e,"title",n[11])},m(i,o){W(i,e,o),e.innerHTML=t},p(i,o){o[0]&4096&&t!==(t=i[12].error+"")&&(e.innerHTML=t),o[0]&2048&&f(e,"title",i[11])},d(i){i&&M(e)}}}function Xt(n){let e,t=n[12].expired+"";return{c(){e=R("div"),f(e,"title",n[11])},m(i,o){W(i,e,o),e.innerHTML=t},p(i,o){o[0]&4096&&t!==(t=i[12].expired+"")&&(e.innerHTML=t),o[0]&2048&&f(e,"title",i[11])},d(i){i&&M(e)}}}function He(n){let e,t,i=n[12].footer+"";return{c(){e=R("div"),t=R("div"),f(t,"class","svelte-1ffb04m"),f(e,"class","powcha-footer svelte-1ffb04m")},m(o,l){W(o,e,l),k(e,t),t.innerHTML=i},p(o,l){l[0]&4096&&i!==(i=o[12].footer+"")&&(t.innerHTML=i)},d(o){o&&M(e)}}}function Oe(n){let e;return{c(){e=R("div"),f(e,"class","powcha-anchor-arrow svelte-1ffb04m")},m(t,i){W(t,e,i),n[37](e)},p:re,d(t){t&&M(e),n[37](null)}}}function Bt(n){let e,t,i,o,l,s,a,u,d,$,j,V,_,G,J,N=n[7]===g.VERIFYING&&Ue();function se(h,w){return h[7]===g.VERIFIED?Ht:h[7]===g.VERIFYING?Gt:$t}let Y=se(n),F=Y(n),x=n[3]!==!0&&$e(n),I=(n[11]||n[7]===g.EXPIRED)&&Ge(n),S=n[12].footer&&n[2]!==!0&&He(n),v=n[1]&&Oe(n);return{c(){e=R("div"),t=R("div"),N&&N.c(),i=B(),o=R("div"),l=R("input"),u=B(),d=R("div"),F.c(),$=B(),x&&x.c(),j=B(),I&&I.c(),V=B(),S&&S.c(),_=B(),v&&v.c(),f(l,"type","checkbox"),f(l,"id",s=n[4]+"_checkbox"),l.required=a=n[0]!=="onsubmit",f(l,"class","svelte-1ffb04m"),f(o,"class","powcha-checkbox svelte-1ffb04m"),Ze(o,"powcha-hidden",n[7]===g.VERIFYING),f(d,"class","powcha-label svelte-1ffb04m"),f(t,"class","powcha-main svelte-1ffb04m"),f(e,"class","powcha svelte-1ffb04m"),f(e,"data-state",n[7]),f(e,"data-floating",n[1])},m(h,w){W(h,e,w),k(e,t),N&&N.m(t,null),k(t,i),k(t,o),k(o,l),l.checked=n[8],k(t,u),k(t,d),F.m(d,null),k(t,$),x&&x.m(t,null),k(e,j),I&&I.m(e,null),k(e,V),S&&S.m(e,null),k(e,_),v&&v.m(e,null),n[38](e),G||(J=[ke(l,"change",n[36]),ke(l,"change",n[13]),ke(l,"invalid",n[14])],G=!0)},p(h,w){h[7]===g.VERIFYING?N||(N=Ue(),N.c(),N.m(t,i)):N&&(N.d(1),N=null),w[0]&16&&s!==(s=h[4]+"_checkbox")&&f(l,"id",s),w[0]&1&&a!==(a=h[0]!=="onsubmit")&&(l.required=a),w[0]&256&&(l.checked=h[8]),w[0]&128&&Ze(o,"powcha-hidden",h[7]===g.VERIFYING),Y===(Y=se(h))&&F?F.p(h,w):(F.d(1),F=Y(h),F&&(F.c(),F.m(d,null))),h[3]!==!0?x?x.p(h,w):(x=$e(h),x.c(),x.m(t,null)):x&&(x.d(1),x=null),h[11]||h[7]===g.EXPIRED?I?I.p(h,w):(I=Ge(h),I.c(),I.m(e,V)):I&&(I.d(1),I=null),h[12].footer&&h[2]!==!0?S?S.p(h,w):(S=He(h),S.c(),S.m(e,_)):S&&(S.d(1),S=null),h[1]?v?v.p(h,w):(v=Oe(h),v.c(),v.m(e,null)):v&&(v.d(1),v=null),w[0]&128&&f(e,"data-state",h[7]),w[0]&2&&f(e,"data-floating",h[1])},i:re,o:re,d(h){h&&M(e),N&&N.d(),F.d(),x&&x.d(),I&&I.d(),S&&S.d(),v&&v.d(),n[38](null),G=!1,fe(J)}}}const Xe="PoWCHA",Be="https://github.com/TundraWork/powcha-web";function Ye(n){return JSON.parse(n)}function Yt(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{}}function Kt(n,e,t){var at,ut;let i,o,l,{auto:s=void 0}=e,{blockspam:a=void 0}=e,{challengeurl:u=void 0}=e,{challengejson:d=void 0}=e,{debug:$=!1}=e,{delay:j=0}=e,{expire:V=void 0}=e,{floating:_=void 0}=e,{floatinganchor:G=void 0}=e,{floatingoffset:J=void 0}=e,{hidefooter:N=!1}=e,{hidelogo:se=!1}=e,{name:Y="powcha"}=e,{formfieldname:F="powcha"}=e,{maxnumber:x=1e6}=e,{mockerror:I=!1}=e,{refetchonexpire:S=!0}=e,{spamfilter:v=!1}=e,{strings:h=void 0}=e,{test:w=!1}=e,{verifyurl:q=void 0}=e,{workers:ue=Math.min(16,navigator.hardwareConcurrency||8)}=e,{workerurl:be=void 0}=e;const Re=Et(),ze=["SHA-256","SHA-384","SHA-512"],Je=(ut=(at=document.documentElement.lang)==null?void 0:at.split("-"))==null?void 0:ut[0];let K=!1,E,Q=null,we=null,b=null,Ie=null,ee=null,D=g.UNVERIFIED,O=null;xt(()=>{b&&(b.removeEventListener("submit",Qe),b.removeEventListener("reset",et),b.removeEventListener("focusin",qe),b=null),O&&(clearTimeout(O),O=null),document.removeEventListener("click",it),document.removeEventListener("scroll",ot),window.removeEventListener("resize",st)}),kt(()=>{L("mounted","0.6.5"),L("workers",ue),w&&L("using test mode"),V&&pe(V),s!==void 0&&L("auto",s),_!==void 0&&ft(_),b=E.closest("form"),b&&(b.addEventListener("submit",Qe,{capture:!0}),b.addEventListener("reset",et),s==="onfocus"&&b.addEventListener("focusin",qe)),s==="onload"&&te()});function L(...r){($||r.some(c=>c instanceof Error))&&console[r[0]instanceof Error?"error":"log"]("PoWCHA",...r)}function qe(r){D===g.UNVERIFIED&&te()}function Qe(r){b&&s==="onsubmit"&&(D===g.UNVERIFIED?(r.preventDefault(),r.stopPropagation(),te().then(()=>{b==null||b.requestSubmit()})):D!==g.VERIFIED&&(r.preventDefault(),r.stopPropagation(),D===g.VERIFYING&&lt()))}function et(){ve()}function tt(r,c){return btoa(JSON.stringify({algorithm:r.algorithm,challenge:r.challenge,number:c.number,salt:r.salt,signature:r.signature,test:w?!0:void 0,took:c.took}))}function nt(r){if(!r.algorithm)throw new Error("Invalid challenge. Property algorithm is missing.");if(r.signature===void 0)throw new Error("Invalid challenge. Property signature is missing.");if(!ze.includes(r.algorithm.toUpperCase()))throw new Error(`Unknown algorithm value. Allowed values: ${ze.join(", ")}`);if(!r.challenge||r.challenge.length<40)throw new Error("Challenge is too short. Min. 40 chars.");if(!r.salt||r.salt.length<10)throw new Error("Salt is too short. Min. 10 chars.")}async function zt(){var r;if(I)throw L("mocking error"),new Error("Mocked error.");if(i)return L("using provided json data"),i;if(w)return L("generating test challenge",{test:w}),Vt(typeof w!="boolean"?+w:void 0);{if(!u)throw new Error("Attribute challengeurl not set.");L("fetching challenge from",u);const c=await fetch(u,{headers:{"x-powcha-spam-filter":v?"1":"0"}});if(c.status!==200)throw new Error(`Server responded with ${c.status}.`);const m=c.headers.get("Expires"),A=c.headers.get("X-powcha-Config"),P=await c.json(),T=new URLSearchParams((r=P.salt.split("?"))==null?void 0:r[1]),X=T.get("expires")||T.get("expire");if(X){const y=new Date(+X*1e3),C=isNaN(y.getTime())?0:y.getTime()-Date.now();C>0&&pe(C)}if(A)try{const y=JSON.parse(A);y&&typeof y=="object"&&(y.verifyurl&&(y.verifyurl=new URL(y.verifyurl,new URL(u)).toString()),ct(y))}catch(y){L("unable to configure from X-powcha-Config",y)}if(!V&&(m!=null&&m.length)){const y=Date.parse(m);if(y){const C=y-Date.now();C>0&&pe(C)}}return P}}function rt(){u&&S&&D===g.VERIFIED?te():ve(g.EXPIRED,l.expired)}async function Jt(r){let c=null;if("Worker"in window){try{c=await qt(r.challenge,r.salt,r.algorithm,r.maxnumber)}catch(m){L(m)}if((c==null?void 0:c.number)!==void 0)return{data:r,solution:c}}return{data:r,solution:await Ft(r.challenge,r.salt,r.algorithm,r.maxnumber||x).promise}}async function qt(r,c,m,A=typeof w=="number"?w:x,P=Math.ceil(ue)){const T=[];P=Math.min(16,Math.max(1,P));for(let C=0;C<P;C++)T.push(createPoWCHAWorker(be));const X=Math.ceil(A/P),y=await Promise.all(T.map((C,Ae)=>{const de=Ae*X;return new Promise(ye=>{C.addEventListener("message",_e=>{if(_e.data)for(const he of T)he!==C&&he.postMessage({type:"abort"});ye(_e.data)}),C.postMessage({payload:{alg:m,challenge:r,max:de+X,salt:c,start:de},type:"work"})})}));for(const C of T)C.terminate();return y.find(C=>!!C)||null}function Qt(){[g.UNVERIFIED,g.ERROR,g.EXPIRED].includes(D)?v&&(b==null?void 0:b.reportValidity())===!1?t(8,K=!1):te():t(8,K=!0)}function it(r){const c=r.target;_&&c&&!E.contains(c)&&D===g.VERIFIED&&t(9,E.style.display="none",E)}function ot(){_&&Se()}function lt(){D===g.VERIFYING&&l.waitAlert&&alert(l.waitAlert)}function en(r){_&&D!==g.UNVERIFIED&&requestAnimationFrame(()=>{Se()})}function st(){_&&Se()}function pe(r){L("expire",r),O&&(clearTimeout(O),O=null),r<1?rt():O=setTimeout(rt,r)}function ft(r){L("floating",r),_!==r&&(t(9,E.style.left="",E),t(9,E.style.top="",E)),t(1,_=r===!0||r===""?"auto":r===!1||r==="false"?void 0:_),_?(s||t(0,s="onsubmit"),document.addEventListener("scroll",ot),document.addEventListener("click",it),window.addEventListener("resize",st)):s==="onsubmit"&&t(0,s=void 0)}function tn(r){var m;const c=b==null?void 0:b.querySelector(typeof r=="string"?`input[name="${r}"]`:'input[type="email"]:not([data-no-spamfilter])');return((m=c==null?void 0:c.value)==null?void 0:m.slice(c.value.indexOf("@")))||void 0}function nn(r){return[...(b==null?void 0:b.querySelectorAll(r!=null&&r.length?r.map(m=>`input[name="${m}"]`).join(", "):'input[type="text"]:not([data-no-spamfilter]), textarea:not([data-no-spamfilter])'))||[]].reduce((m,A)=>{const P=A.name,T=A.value;return P&&T&&(m[P]=/\n/.test(T)?T.replace(new RegExp("(?<!\\r)\\n","g"),`\r
`):T),m},{})}async function rn(r){if(!q)throw new Error("Attribute verifyurl not set.");L("requesting server verification from",q);const c={payload:r};if(v){const{blockedCountries:P,classifier:T,disableRules:X,email:y,expectedLanguages:C,expectedCountries:Ae,fields:de,ipAddress:ye,text:_e,timeZone:he}=on();c.blockedCountries=P,c.classifier=T,c.disableRules=X,c.email=y===!1?void 0:tn(y),c.expectedCountries=Ae,c.expectedLanguages=C||(Je?[Je]:void 0),c.fields=de===!1?void 0:nn(de),c.ipAddress=ye===!1?void 0:ye||"auto",c.text=_e,c.timeZone=he===!1?void 0:he||Yt()}const m=await fetch(q,{body:JSON.stringify(c),headers:{"content-type":"application/json"},method:"POST"});if(m.status!==200)throw new Error(`Server responded with ${m.status}.`);const A=await m.json();if(A!=null&&A.payload&&t(6,ee=A.payload),Re("serververification",A),a&&A.classification==="BAD")throw new Error("SpamFilter returned negative classification.")}function on(){return v==="ipAddress"?{blockedCountries:void 0,classifier:void 0,disableRules:void 0,email:!1,expectedCountries:void 0,expectedLanguages:void 0,fields:!1,ipAddress:void 0,text:void 0,timeZone:void 0}:typeof v=="object"?v:{blockedCountries:void 0,classifier:void 0,disableRules:void 0,email:void 0,expectedCountries:void 0,expectedLanguages:void 0,fields:void 0,ipAddress:void 0,text:void 0,timeZone:void 0}}function Se(r=20){if(E)if(we||(we=(G?document.querySelector(G):b==null?void 0:b.querySelector('input[type="submit"], button[type="submit"], button:not([type="button"]):not([type="reset"])'))||b),we){const c=parseInt(J,10)||12,m=we.getBoundingClientRect(),A=E.getBoundingClientRect(),P=document.documentElement.clientHeight,T=document.documentElement.clientWidth,X=_==="auto"?m.bottom+A.height+c+r>P:_==="top",y=Math.max(r,Math.min(T-r-A.width,m.left+m.width/2-A.width/2));if(X?t(9,E.style.top=`${m.top-(A.height+c)}px`,E):t(9,E.style.top=`${m.bottom+c}px`,E),t(9,E.style.left=`${y}px`,E),E.setAttribute("data-floating",X?"top":"bottom"),Q){const C=Q.getBoundingClientRect();t(10,Q.style.left=m.left-y+m.width/2-C.width/2+"px",Q)}}else L("unable to find floating anchor element")}function ct(r){r.auto!==void 0&&(t(0,s=r.auto),s==="onload"&&te()),r.floatinganchor!==void 0&&t(19,G=r.floatinganchor),r.delay!==void 0&&t(17,j=r.delay),r.floatingoffset!==void 0&&t(20,J=r.floatingoffset),r.floating!==void 0&&ft(r.floating),r.expire!==void 0&&(pe(r.expire),t(18,V=r.expire)),r.challenge&&(nt(r.challenge),i=r.challenge),r.challengeurl!==void 0&&t(15,u=r.challengeurl),r.debug!==void 0&&t(16,$=!!r.debug),r.hidefooter!==void 0&&t(2,N=!!r.hidefooter),r.hidelogo!==void 0&&t(3,se=!!r.hidelogo),r.maxnumber!==void 0&&t(21,x=+r.maxnumber),r.mockerror!==void 0&&t(22,I=!!r.mockerror),r.name!==void 0&&t(4,Y=r.name),r.refetchonexpire!==void 0&&t(23,S=!!r.refetchonexpire),r.spamfilter!==void 0&&t(24,v=typeof r.spamfilter=="object"?r.spamfilter:!!r.spamfilter),r.strings&&t(35,o=r.strings),r.test!==void 0&&t(25,w=typeof r.test=="number"?r.test:!!r.test),r.verifyurl!==void 0&&t(26,q=r.verifyurl),r.workers!==void 0&&t(27,ue=+r.workers),r.workerurl!==void 0&&t(28,be=r.workerurl)}function ve(r=g.UNVERIFIED,c=null){O&&(clearTimeout(O),O=null),t(8,K=!1),t(11,Ie=c),t(6,ee=null),t(7,D=r)}async function te(){return ve(g.VERIFYING),await new Promise(r=>setTimeout(r,j||0)),zt().then(r=>(nt(r),L("challenge",r),Jt(r))).then(({data:r,solution:c})=>{if(L("solution",c),(c==null?void 0:c.number)!==void 0){if(q)return rn(tt(r,c));t(6,ee=tt(r,c)),L("payload",ee)}else throw L("Unable to find a solution. Ensure that the 'maxnumber' attribute is greater than the randomly generated number."),new Error("Unexpected result returned.")}).then(()=>{Lt().then(()=>{t(7,D=g.VERIFIED),t(8,K=!0),L("verified"),Re("verified",{payload:ee})})}).catch(r=>{L(r),t(7,D=g.ERROR),t(8,K=!1),t(11,Ie=r.message)})}function ln(){K=this.checked,t(8,K)}function sn(r){me[r?"unshift":"push"](()=>{Q=r,t(10,Q)})}function fn(r){me[r?"unshift":"push"](()=>{E=r,t(9,E)})}return n.$$set=r=>{"auto"in r&&t(0,s=r.auto),"blockspam"in r&&t(29,a=r.blockspam),"challengeurl"in r&&t(15,u=r.challengeurl),"challengejson"in r&&t(30,d=r.challengejson),"debug"in r&&t(16,$=r.debug),"delay"in r&&t(17,j=r.delay),"expire"in r&&t(18,V=r.expire),"floating"in r&&t(1,_=r.floating),"floatinganchor"in r&&t(19,G=r.floatinganchor),"floatingoffset"in r&&t(20,J=r.floatingoffset),"hidefooter"in r&&t(2,N=r.hidefooter),"hidelogo"in r&&t(3,se=r.hidelogo),"name"in r&&t(4,Y=r.name),"formfieldname"in r&&t(5,F=r.formfieldname),"maxnumber"in r&&t(21,x=r.maxnumber),"mockerror"in r&&t(22,I=r.mockerror),"refetchonexpire"in r&&t(23,S=r.refetchonexpire),"spamfilter"in r&&t(24,v=r.spamfilter),"strings"in r&&t(31,h=r.strings),"test"in r&&t(25,w=r.test),"verifyurl"in r&&t(26,q=r.verifyurl),"workers"in r&&t(27,ue=r.workers),"workerurl"in r&&t(28,be=r.workerurl)},n.$$.update=()=>{n.$$.dirty[0]&1073741824&&(i=d?Ye(d):void 0),n.$$.dirty[1]&1&&t(35,o=h?Ye(h):{}),n.$$.dirty[1]&16&&t(12,l={ariaLinkLabel:Xe,error:"Verification failed. Try again later.",expired:"Work timed out. Please try again.",footer:`Protected by <a href="${Be}" target="_blank" aria-label="${o.ariaLinkLabel||Xe}">PoWCHA</a>`,label:"I'm not a bad robot",verified:"You're good to go! 🎉",verifying:"Working... ⚙️",waitAlert:"Still working... Please wait.",...o}),n.$$.dirty[0]&192&&Re("statechange",{payload:ee,state:D}),n.$$.dirty[0]&128&&en()},[s,_,N,se,Y,F,ee,D,K,E,Q,Ie,l,Qt,lt,u,$,j,V,G,J,x,I,S,v,w,q,ue,be,a,d,h,ct,ve,te,o,ln,sn,fn]}class Ke extends Zt{constructor(e){super(),Tt(this,e,Kt,Bt,ht,{auto:0,blockspam:29,challengeurl:15,challengejson:30,debug:16,delay:17,expire:18,floating:1,floatinganchor:19,floatingoffset:20,hidefooter:2,hidelogo:3,name:4,formfieldname:5,maxnumber:21,mockerror:22,refetchonexpire:23,spamfilter:24,strings:31,test:25,verifyurl:26,workers:27,workerurl:28,configure:32,reset:33,verify:34},Ut,[-1,-1,-1])}get auto(){return this.$$.ctx[0]}set auto(e){this.$$set({auto:e}),p()}get blockspam(){return this.$$.ctx[29]}set blockspam(e){this.$$set({blockspam:e}),p()}get challengeurl(){return this.$$.ctx[15]}set challengeurl(e){this.$$set({challengeurl:e}),p()}get challengejson(){return this.$$.ctx[30]}set challengejson(e){this.$$set({challengejson:e}),p()}get debug(){return this.$$.ctx[16]}set debug(e){this.$$set({debug:e}),p()}get delay(){return this.$$.ctx[17]}set delay(e){this.$$set({delay:e}),p()}get expire(){return this.$$.ctx[18]}set expire(e){this.$$set({expire:e}),p()}get floating(){return this.$$.ctx[1]}set floating(e){this.$$set({floating:e}),p()}get floatinganchor(){return this.$$.ctx[19]}set floatinganchor(e){this.$$set({floatinganchor:e}),p()}get floatingoffset(){return this.$$.ctx[20]}set floatingoffset(e){this.$$set({floatingoffset:e}),p()}get hidefooter(){return this.$$.ctx[2]}set hidefooter(e){this.$$set({hidefooter:e}),p()}get hidelogo(){return this.$$.ctx[3]}set hidelogo(e){this.$$set({hidelogo:e}),p()}get name(){return this.$$.ctx[4]}set name(e){this.$$set({name:e}),p()}get formfieldname(){return this.$$.ctx[5]}set formfieldname(e){this.$$set({formfieldname:e}),p()}get maxnumber(){return this.$$.ctx[21]}set maxnumber(e){this.$$set({maxnumber:e}),p()}get mockerror(){return this.$$.ctx[22]}set mockerror(e){this.$$set({mockerror:e}),p()}get refetchonexpire(){return this.$$.ctx[23]}set refetchonexpire(e){this.$$set({refetchonexpire:e}),p()}get spamfilter(){return this.$$.ctx[24]}set spamfilter(e){this.$$set({spamfilter:e}),p()}get strings(){return this.$$.ctx[31]}set strings(e){this.$$set({strings:e}),p()}get test(){return this.$$.ctx[25]}set test(e){this.$$set({test:e}),p()}get verifyurl(){return this.$$.ctx[26]}set verifyurl(e){this.$$set({verifyurl:e}),p()}get workers(){return this.$$.ctx[27]}set workers(e){this.$$set({workers:e}),p()}get workerurl(){return this.$$.ctx[28]}set workerurl(e){this.$$set({workerurl:e}),p()}get configure(){return this.$$.ctx[32]}get reset(){return this.$$.ctx[33]}get verify(){return this.$$.ctx[34]}}customElements.define("powcha-widget",Mt(Ke,{auto:{},blockspam:{},challengeurl:{},challengejson:{},debug:{type:"Boolean"},delay:{},expire:{},floating:{},floatinganchor:{},floatingoffset:{},hidefooter:{type:"Boolean"},hidelogo:{type:"Boolean"},name:{},formfieldname:{},maxnumber:{},mockerror:{type:"Boolean"},refetchonexpire:{type:"Boolean"},spamfilter:{type:"Boolean"},strings:{},test:{type:"Boolean"},verifyurl:{},workers:{},workerurl:{}},[],["configure","reset","verify"],!1)),globalThis.createPoWCHAWorker=n=>n?new Worker(new URL(n)):new dt,U.Altcha=Ke,Object.defineProperty(U,Symbol.toStringTag,{value:"Module"})});
