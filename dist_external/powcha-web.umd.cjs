(function(O,P){typeof exports=="object"&&typeof module<"u"?P(exports):typeof define=="function"&&define.amd?define(["exports"],P):(O=typeof globalThis<"u"?globalThis:O||self,P(O.powcha={}))})(this,function(O){"use strict";var tn=Object.defineProperty;var nn=(O,P,q)=>P in O?tn(O,P,{enumerable:!0,configurable:!0,writable:!0,value:q}):O[P]=q;var W=(O,P,q)=>nn(O,typeof P!="symbol"?P+"":P,q);var P=typeof document<"u"?document.currentScript:null;function q(){}function Se(n){return n()}function $e(){return Object.create(null)}function se(n){n.forEach(Se)}function Me(n){return typeof n=="function"}function ut(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function at(n){return Object.keys(n).length===0}function C(n,e){n.appendChild(e)}function D(n,e,t){n.insertBefore(e,t||null)}function j(n){n.parentNode&&n.parentNode.removeChild(n)}function S(n){return document.createElement(n)}function z(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function ht(n){return document.createTextNode(n)}function Z(){return ht(" ")}function ke(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function f(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function dt(n){return Array.from(n.childNodes)}function Te(n,e,t){n.classList.toggle(e,!!t)}function gt(n,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:i})}function mt(n){const e={};return n.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}let fe;function ce(n){fe=n}function pe(){if(!fe)throw new Error("Function called outside component initialization");return fe}function bt(n){pe().$$.on_mount.push(n)}function wt(n){pe().$$.on_destroy.push(n)}function _t(){const n=pe();return(e,t,{cancelable:i=!1}={})=>{const l=n.$$.callbacks[e];if(l){const o=gt(e,t,{cancelable:i});return l.slice().forEach(s=>{s.call(n,o)}),!o.defaultPrevented}return!0}}const re=[],de=[];let ie=[];const je=[],Pe=Promise.resolve();let Ee=!1;function De(){Ee||(Ee=!0,Pe.then(_))}function yt(){return De(),Pe}function xe(n){ie.push(n)}const Le=new Set;let oe=0;function _(){if(oe!==0)return;const n=fe;do{try{for(;oe<re.length;){const e=re[oe];oe++,ce(e),vt(e.$$)}}catch(e){throw re.length=0,oe=0,e}for(ce(null),re.length=0,oe=0;de.length;)de.pop()();for(let e=0;e<ie.length;e+=1){const t=ie[e];Le.has(t)||(Le.add(t),t())}ie.length=0}while(re.length);for(;je.length;)je.pop()();Ee=!1,Le.clear(),ce(n)}function vt(n){if(n.fragment!==null){n.update(),se(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(xe)}}function kt(n){const e=[],t=[];ie.forEach(i=>n.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),ie=e}const pt=new Set;function Et(n,e){n&&n.i&&(pt.delete(n),n.i(e))}function xt(n,e,t){const{fragment:i,after_update:l}=n.$$;i&&i.m(e,t),xe(()=>{const o=n.$$.on_mount.map(Se).filter(Me);n.$$.on_destroy?n.$$.on_destroy.push(...o):se(o),n.$$.on_mount=[]}),l.forEach(xe)}function Lt(n,e){const t=n.$$;t.fragment!==null&&(kt(t.after_update),se(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Ct(n,e){n.$$.dirty[0]===-1&&(re.push(n),De(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function It(n,e,t,i,l,o,s=null,u=[-1]){const a=fe;ce(n);const h=n.$$={fragment:null,ctx:[],props:o,update:q,not_equal:l,bound:$e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:$e(),dirty:u,skip_bound:!1,root:e.target||a.$$.root};s&&s(h.root);let B=!1;if(h.ctx=t?t(n,e.props||{},(M,H,...k)=>{const U=k.length?k[0]:H;return h.ctx&&l(h.ctx[M],h.ctx[M]=U)&&(!h.skip_bound&&h.bound[M]&&h.bound[M](U),B&&Ct(n,M)),H}):[],h.update(),B=!0,se(h.before_update),h.fragment=i?i(h.ctx):!1,e.target){if(e.hydrate){const M=dt(e.target);h.fragment&&h.fragment.l(M),M.forEach(j)}else h.fragment&&h.fragment.c();e.intro&&Et(n.$$.fragment),xt(n,e.target,e.anchor),_()}ce(a)}let Ne;typeof HTMLElement=="function"&&(Ne=class extends HTMLElement{constructor(e,t,i){super();W(this,"$$ctor");W(this,"$$s");W(this,"$$c");W(this,"$$cn",!1);W(this,"$$d",{});W(this,"$$r",!1);W(this,"$$p_d",{});W(this,"$$l",{});W(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,i&&this.attachShadow({mode:"open"})}addEventListener(e,t,i){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){const l=this.$$c.$on(e,t);this.$$l_u.set(t,l)}super.addEventListener(e,t,i)}removeEventListener(e,t,i){if(super.removeEventListener(e,t,i),this.$$c){const l=this.$$l_u.get(t);l&&(l(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(o){return()=>{let s;return{c:function(){s=S("slot"),o!=="default"&&f(s,"name",o)},m:function(h,B){D(h,s,B)},d:function(h){h&&j(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;const t={},i=mt(this);for(const o of this.$$s)o in i&&(t[o]=[e(o)]);for(const o of this.attributes){const s=this.$$g_p(o.name);s in this.$$d||(this.$$d[s]=ge(s,o.value,this.$$p_d,"toProp"))}for(const o in this.$$p_d)!(o in this.$$d)&&this[o]!==void 0&&(this.$$d[o]=this[o],delete this[o]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});const l=()=>{this.$$r=!0;for(const o in this.$$p_d)if(this.$$d[o]=this.$$c.$$.ctx[this.$$c.$$.props[o]],this.$$p_d[o].reflect){const s=ge(o,this.$$d[o],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[o].attribute||o):this.setAttribute(this.$$p_d[o].attribute||o,s)}this.$$r=!1};this.$$c.$$.after_update.push(l),l();for(const o in this.$$l)for(const s of this.$$l[o]){const u=this.$$c.$on(o,s);this.$$l_u.set(s,u)}this.$$l={}}}attributeChangedCallback(e,t,i){var l;this.$$r||(e=this.$$g_p(e),this.$$d[e]=ge(e,i,this.$$p_d,"toProp"),(l=this.$$c)==null||l.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function ge(n,e,t,i){var o;const l=(o=t[n])==null?void 0:o.type;if(e=l==="Boolean"&&typeof e!="boolean"?e!=null:e,!i||!t[n])return e;if(i==="toAttribute")switch(l){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(l){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}function Rt(n,e,t,i,l,o){let s=class extends Ne{constructor(){super(n,t,l),this.$$p_d=e}static get observedAttributes(){return Object.keys(e).map(u=>(e[u].attribute||u).toLowerCase())}};return Object.keys(e).forEach(u=>{Object.defineProperty(s.prototype,u,{get(){return this.$$c&&u in this.$$c?this.$$c[u]:this.$$d[u]},set(a){var h;a=ge(u,a,e),this.$$d[u]=a,(h=this.$$c)==null||h.$set({[u]:a})}})}),i.forEach(u=>{Object.defineProperty(s.prototype,u,{get(){var a;return(a=this.$$c)==null?void 0:a[u]}})}),o&&(s=o(s)),n.element=s,s}class At{constructor(){W(this,"$$");W(this,"$$set")}$destroy(){Lt(this,1),this.$destroy=q}$on(e,t){if(!Me(t))return q;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!at(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const St="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(St);const $t=new TextEncoder;function Mt(n){return[...new Uint8Array(n)].map(e=>e.toString(16).padStart(2,"0")).join("")}async function Tt(n,e="SHA-256",t=1e5){const i=Date.now().toString(16);n||(n=Math.round(Math.random()*t));const l=await Fe(i,n,e);return{algorithm:e,challenge:l,salt:i,signature:""}}async function Fe(n,e,t){return Mt(await crypto.subtle.digest(t.toUpperCase(),$t.encode(n+e)))}function jt(n,e,t="SHA-256",i=1e6,l=0){const o=new AbortController,s=Date.now();return{promise:(async()=>{for(let a=l;a<=i;a+=1){if(o.signal.aborted)return null;if(await Fe(e,a,t)===n)return{number:a,took:Date.now()-s}}return null})(),controller:o}}var m=(n=>(n.ERROR="error",n.VERIFIED="verified",n.VERIFYING="verifying",n.UNVERIFIED="unverified",n.EXPIRED="expired",n))(m||{});function He(n){let e,t,i;return{c(){e=z("svg"),t=z("path"),i=z("path"),f(t,"d","M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z"),f(t,"fill","currentColor"),f(t,"opacity",".25"),f(i,"d","M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z"),f(i,"fill","currentColor"),f(i,"class","powcha-spinner"),f(e,"width","24"),f(e,"height","24"),f(e,"viewBox","0 0 24 24"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(l,o){D(l,e,o),C(e,t),C(e,i)},d(l){l&&j(e)}}}function Pt(n){let e,t=n[12].label+"",i;return{c(){e=S("label"),f(e,"for",i=n[4]+"_checkbox")},m(l,o){D(l,e,o),e.innerHTML=t},p(l,o){o[0]&4096&&t!==(t=l[12].label+"")&&(e.innerHTML=t),o[0]&16&&i!==(i=l[4]+"_checkbox")&&f(e,"for",i)},d(l){l&&j(e)}}}function Dt(n){let e,t=n[12].verifying+"";return{c(){e=S("span")},m(i,l){D(i,e,l),e.innerHTML=t},p(i,l){l[0]&4096&&t!==(t=i[12].verifying+"")&&(e.innerHTML=t)},d(i){i&&j(e)}}}function Nt(n){let e,t=n[12].verified+"",i,l;return{c(){e=S("span"),i=Z(),l=S("input"),f(l,"type","hidden"),f(l,"name",n[5]),l.value=n[6]},m(o,s){D(o,e,s),e.innerHTML=t,D(o,i,s),D(o,l,s)},p(o,s){s[0]&4096&&t!==(t=o[12].verified+"")&&(e.innerHTML=t),s[0]&32&&f(l,"name",o[5]),s[0]&64&&(l.value=o[6])},d(o){o&&(j(e),j(i),j(l))}}}function Ve(n){let e,t,i,l,o;return{c(){e=S("div"),t=S("a"),i=z("svg"),l=z("path"),f(l,"d","M 12 2 C 6.486 2 2 6.486 2 12 C 2 17.514 6.486 22 12 22 C 17.514 22 22 17.514 22 12 C 22 10.874 21.803984 9.7942031 21.458984 8.7832031 L 19.839844 10.402344 C 19.944844 10.918344 20 11.453 20 12 C 20 16.411 16.411 20 12 20 C 7.589 20 4 16.411 4 12 C 4 7.589 7.589 4 12 4 C 13.633 4 15.151922 4.4938906 16.419922 5.3378906 L 17.851562 3.90625 C 16.203562 2.71225 14.185 2 12 2 z M 21.292969 3.2929688 L 11 13.585938 L 7.7070312 10.292969 L 6.2929688 11.707031 L 11 16.414062 L 22.707031 4.7070312 L 21.292969 3.2929688 z"),f(l,"fill","currentColor"),f(i,"width","24"),f(i,"height","24"),f(i,"viewBox","0 0 24 24"),f(i,"fill","none"),f(i,"xmlns","http://www.w3.org/2000/svg"),f(t,"href",qe),f(t,"target","_blank"),f(t,"class","powcha-logo"),f(t,"aria-label",o=n[12].ariaLinkLabel),f(e,"class","powcha-brand")},m(s,u){D(s,e,u),C(e,t),C(t,i),C(i,l)},p(s,u){u[0]&4096&&o!==(o=s[12].ariaLinkLabel)&&f(t,"aria-label",o)},d(s){s&&j(e)}}}function Oe(n){let e,t,i,l;function o(a,h){return a[7]===m.EXPIRED?Ht:Ft}let s=o(n),u=s(n);return{c(){e=S("div"),t=z("svg"),i=z("path"),l=Z(),u.c(),f(i,"stroke-linecap","round"),f(i,"stroke-linejoin","round"),f(i,"d","M6 18L18 6M6 6l12 12"),f(t,"width","14"),f(t,"height","14"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width","1.5"),f(t,"stroke","currentColor"),f(e,"class","powcha-error")},m(a,h){D(a,e,h),C(e,t),C(t,i),C(e,l),u.m(e,null)},p(a,h){s===(s=o(a))&&u?u.p(a,h):(u.d(1),u=s(a),u&&(u.c(),u.m(e,null)))},d(a){a&&j(e),u.d()}}}function Ft(n){let e,t=n[12].error+"";return{c(){e=S("div"),f(e,"title",n[11])},m(i,l){D(i,e,l),e.innerHTML=t},p(i,l){l[0]&4096&&t!==(t=i[12].error+"")&&(e.innerHTML=t),l[0]&2048&&f(e,"title",i[11])},d(i){i&&j(e)}}}function Ht(n){let e,t=n[12].expired+"";return{c(){e=S("div"),f(e,"title",n[11])},m(i,l){D(i,e,l),e.innerHTML=t},p(i,l){l[0]&4096&&t!==(t=i[12].expired+"")&&(e.innerHTML=t),l[0]&2048&&f(e,"title",i[11])},d(i){i&&j(e)}}}function Be(n){let e,t,i=n[12].footer+"";return{c(){e=S("div"),t=S("div"),f(e,"class","powcha-footer")},m(l,o){D(l,e,o),C(e,t),t.innerHTML=i},p(l,o){o[0]&4096&&i!==(i=l[12].footer+"")&&(t.innerHTML=i)},d(l){l&&j(e)}}}function Ue(n){let e;return{c(){e=S("div"),f(e,"class","powcha-anchor-arrow")},m(t,i){D(t,e,i),n[37](e)},p:q,d(t){t&&j(e),n[37](null)}}}function Vt(n){let e,t,i,l,o,s,u,a,h,B,M,H,k,U,K,$=n[7]===m.VERIFYING&&He();function le(d,w){return d[7]===m.VERIFIED?Nt:d[7]===m.VERIFYING?Dt:Pt}let X=le(n),V=X(n),p=n[3]!==!0&&Ve(n),I=(n[11]||n[7]===m.EXPIRED)&&Oe(n),R=n[12].footer&&n[2]!==!0&&Be(n),y=n[1]&&Ue(n);return{c(){e=S("div"),t=S("div"),$&&$.c(),i=Z(),l=S("div"),o=S("input"),a=Z(),h=S("div"),V.c(),B=Z(),p&&p.c(),M=Z(),I&&I.c(),H=Z(),R&&R.c(),k=Z(),y&&y.c(),f(o,"type","checkbox"),f(o,"id",s=n[4]+"_checkbox"),o.required=u=n[0]!=="onsubmit",f(l,"class","powcha-checkbox"),Te(l,"powcha-hidden",n[7]===m.VERIFYING),f(h,"class","powcha-label"),f(t,"class","powcha-main"),f(e,"class","powcha"),f(e,"data-state",n[7]),f(e,"data-floating",n[1])},m(d,w){D(d,e,w),C(e,t),$&&$.m(t,null),C(t,i),C(t,l),C(l,o),o.checked=n[8],C(t,a),C(t,h),V.m(h,null),C(t,B),p&&p.m(t,null),C(e,M),I&&I.m(e,null),C(e,H),R&&R.m(e,null),C(e,k),y&&y.m(e,null),n[38](e),U||(K=[ke(o,"change",n[36]),ke(o,"change",n[13]),ke(o,"invalid",n[14])],U=!0)},p(d,w){d[7]===m.VERIFYING?$||($=He(),$.c(),$.m(t,i)):$&&($.d(1),$=null),w[0]&16&&s!==(s=d[4]+"_checkbox")&&f(o,"id",s),w[0]&1&&u!==(u=d[0]!=="onsubmit")&&(o.required=u),w[0]&256&&(o.checked=d[8]),w[0]&128&&Te(l,"powcha-hidden",d[7]===m.VERIFYING),X===(X=le(d))&&V?V.p(d,w):(V.d(1),V=X(d),V&&(V.c(),V.m(h,null))),d[3]!==!0?p?p.p(d,w):(p=Ve(d),p.c(),p.m(t,null)):p&&(p.d(1),p=null),d[11]||d[7]===m.EXPIRED?I?I.p(d,w):(I=Oe(d),I.c(),I.m(e,H)):I&&(I.d(1),I=null),d[12].footer&&d[2]!==!0?R?R.p(d,w):(R=Be(d),R.c(),R.m(e,k)):R&&(R.d(1),R=null),d[1]?y?y.p(d,w):(y=Ue(d),y.c(),y.m(e,null)):y&&(y.d(1),y=null),w[0]&128&&f(e,"data-state",d[7]),w[0]&2&&f(e,"data-floating",d[1])},i:q,o:q,d(d){d&&j(e),$&&$.d(),V.d(),p&&p.d(),I&&I.d(),R&&R.d(),y&&y.d(),n[38](null),U=!1,se(K)}}}const We="PoWCHA",qe="https://github.com/TundraWork/powcha-web";function Ye(n){return JSON.parse(n)}function Ot(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{}}function Bt(n,e,t){var ft,ct;let i,l,o,{auto:s=void 0}=e,{blockspam:u=void 0}=e,{challengeurl:a=void 0}=e,{challengejson:h=void 0}=e,{debug:B=!1}=e,{delay:M=0}=e,{expire:H=void 0}=e,{floating:k=void 0}=e,{floatinganchor:U=void 0}=e,{floatingoffset:K=void 0}=e,{hidefooter:$=!1}=e,{hidelogo:le=!1}=e,{name:X="powcha"}=e,{formfieldname:V="powcha"}=e,{maxnumber:p=1e6}=e,{mockerror:I=!1}=e,{refetchonexpire:R=!0}=e,{spamfilter:y=!1}=e,{strings:d=void 0}=e,{test:w=!1}=e,{verifyurl:Q=void 0}=e,{workers:ue=Math.min(16,navigator.hardwareConcurrency||8)}=e,{workerurl:me=void 0}=e;const Ce=_t(),Ze=["SHA-256","SHA-384","SHA-512"],Xe=(ct=(ft=document.documentElement.lang)==null?void 0:ft.split("-"))==null?void 0:ct[0];let J=!1,E,ee=null,be=null,b=null,Ie=null,te=null,N=m.UNVERIFIED,Y=null;wt(()=>{b&&(b.removeEventListener("submit",ze),b.removeEventListener("reset",Ke),b.removeEventListener("focusin",Je),b=null),Y&&(clearTimeout(Y),Y=null),document.removeEventListener("click",nt),document.removeEventListener("scroll",rt),window.removeEventListener("resize",ot)}),bt(()=>{x("mounted","0.6.5"),x("workers",ue),w&&x("using test mode"),H&&we(H),s!==void 0&&x("auto",s),k!==void 0&&lt(k),b=E.closest("form"),b&&(b.addEventListener("submit",ze,{capture:!0}),b.addEventListener("reset",Ke),s==="onfocus"&&b.addEventListener("focusin",Je)),s==="onload"&&ne()});function x(...r){(B||r.some(c=>c instanceof Error))&&console[r[0]instanceof Error?"error":"log"]("PoWCHA",...r)}function Je(r){N===m.UNVERIFIED&&ne()}function ze(r){b&&s==="onsubmit"&&(N===m.UNVERIFIED?(r.preventDefault(),r.stopPropagation(),ne().then(()=>{b==null||b.requestSubmit()})):N!==m.VERIFIED&&(r.preventDefault(),r.stopPropagation(),N===m.VERIFYING&&it()))}function Ke(){_e()}function Qe(r,c){return btoa(JSON.stringify({algorithm:r.algorithm,challenge:r.challenge,number:c.number,salt:r.salt,signature:r.signature,test:w?!0:void 0,took:c.took}))}function et(r){if(!r.algorithm)throw new Error("Invalid challenge. Property algorithm is missing.");if(r.signature===void 0)throw new Error("Invalid challenge. Property signature is missing.");if(!Ze.includes(r.algorithm.toUpperCase()))throw new Error(`Unknown algorithm value. Allowed values: ${Ze.join(", ")}`);if(!r.challenge||r.challenge.length<40)throw new Error("Challenge is too short. Min. 40 chars.");if(!r.salt||r.salt.length<10)throw new Error("Salt is too short. Min. 10 chars.")}async function Ut(){var r;if(I)throw x("mocking error"),new Error("Mocked error.");if(i)return x("using provided json data"),i;if(w)return x("generating test challenge",{test:w}),Tt(typeof w!="boolean"?+w:void 0);{if(!a)throw new Error("Attribute challengeurl not set.");x("fetching challenge from",a);const c=await fetch(a,{headers:{"x-powcha-spam-filter":y?"1":"0"}});if(c.status!==200)throw new Error(`Server responded with ${c.status}.`);const g=c.headers.get("Expires"),A=c.headers.get("X-powcha-Config"),F=await c.json(),T=new URLSearchParams((r=F.salt.split("?"))==null?void 0:r[1]),G=T.get("expires")||T.get("expire");if(G){const v=new Date(+G*1e3),L=isNaN(v.getTime())?0:v.getTime()-Date.now();L>0&&we(L)}if(A)try{const v=JSON.parse(A);v&&typeof v=="object"&&(v.verifyurl&&(v.verifyurl=new URL(v.verifyurl,new URL(a)).toString()),st(v))}catch(v){x("unable to configure from X-powcha-Config",v)}if(!H&&(g!=null&&g.length)){const v=Date.parse(g);if(v){const L=v-Date.now();L>0&&we(L)}}return F}}function tt(){a&&R&&N===m.VERIFIED?ne():_e(m.EXPIRED,o.expired)}async function Wt(r){let c=null;if("Worker"in window){try{c=await qt(r.challenge,r.salt,r.algorithm,r.maxnumber)}catch(g){x(g)}if((c==null?void 0:c.number)!==void 0)return{data:r,solution:c}}return{data:r,solution:await jt(r.challenge,r.salt,r.algorithm,r.maxnumber||p).promise}}async function qt(r,c,g,A=typeof w=="number"?w:p,F=Math.ceil(ue)){const T=[];F=Math.min(16,Math.max(1,F));for(let L=0;L<F;L++)T.push(createPoWCHAWorker(me));const G=Math.ceil(A/F),v=await Promise.all(T.map((L,Ae)=>{const ae=Ae*G;return new Promise(ye=>{L.addEventListener("message",ve=>{if(ve.data)for(const he of T)he!==L&&he.postMessage({type:"abort"});ye(ve.data)}),L.postMessage({payload:{alg:g,challenge:r,max:ae+G,salt:c,start:ae},type:"work"})})}));for(const L of T)L.terminate();return v.find(L=>!!L)||null}function Yt(){[m.UNVERIFIED,m.ERROR,m.EXPIRED].includes(N)?y&&(b==null?void 0:b.reportValidity())===!1?t(8,J=!1):ne():t(8,J=!0)}function nt(r){const c=r.target;k&&c&&!E.contains(c)&&N===m.VERIFIED&&t(9,E.style.display="none",E)}function rt(){k&&Re()}function it(){N===m.VERIFYING&&o.waitAlert&&alert(o.waitAlert)}function Gt(r){k&&N!==m.UNVERIFIED&&requestAnimationFrame(()=>{Re()})}function ot(){k&&Re()}function we(r){x("expire",r),Y&&(clearTimeout(Y),Y=null),r<1?tt():Y=setTimeout(tt,r)}function lt(r){x("floating",r),k!==r&&(t(9,E.style.left="",E),t(9,E.style.top="",E)),t(1,k=r===!0||r===""?"auto":r===!1||r==="false"?void 0:k),k?(s||t(0,s="onsubmit"),document.addEventListener("scroll",rt),document.addEventListener("click",nt),window.addEventListener("resize",ot)):s==="onsubmit"&&t(0,s=void 0)}function Zt(r){var g;const c=b==null?void 0:b.querySelector(typeof r=="string"?`input[name="${r}"]`:'input[type="email"]:not([data-no-spamfilter])');return((g=c==null?void 0:c.value)==null?void 0:g.slice(c.value.indexOf("@")))||void 0}function Xt(r){return[...(b==null?void 0:b.querySelectorAll(r!=null&&r.length?r.map(g=>`input[name="${g}"]`).join(", "):'input[type="text"]:not([data-no-spamfilter]), textarea:not([data-no-spamfilter])'))||[]].reduce((g,A)=>{const F=A.name,T=A.value;return F&&T&&(g[F]=/\n/.test(T)?T.replace(new RegExp("(?<!\\r)\\n","g"),`\r
`):T),g},{})}async function Jt(r){if(!Q)throw new Error("Attribute verifyurl not set.");x("requesting server verification from",Q);const c={payload:r};if(y){const{blockedCountries:F,classifier:T,disableRules:G,email:v,expectedLanguages:L,expectedCountries:Ae,fields:ae,ipAddress:ye,text:ve,timeZone:he}=zt();c.blockedCountries=F,c.classifier=T,c.disableRules=G,c.email=v===!1?void 0:Zt(v),c.expectedCountries=Ae,c.expectedLanguages=L||(Xe?[Xe]:void 0),c.fields=ae===!1?void 0:Xt(ae),c.ipAddress=ye===!1?void 0:ye||"auto",c.text=ve,c.timeZone=he===!1?void 0:he||Ot()}const g=await fetch(Q,{body:JSON.stringify(c),headers:{"content-type":"application/json"},method:"POST"});if(g.status!==200)throw new Error(`Server responded with ${g.status}.`);const A=await g.json();if(A!=null&&A.payload&&t(6,te=A.payload),Ce("serververification",A),u&&A.classification==="BAD")throw new Error("SpamFilter returned negative classification.")}function zt(){return y==="ipAddress"?{blockedCountries:void 0,classifier:void 0,disableRules:void 0,email:!1,expectedCountries:void 0,expectedLanguages:void 0,fields:!1,ipAddress:void 0,text:void 0,timeZone:void 0}:typeof y=="object"?y:{blockedCountries:void 0,classifier:void 0,disableRules:void 0,email:void 0,expectedCountries:void 0,expectedLanguages:void 0,fields:void 0,ipAddress:void 0,text:void 0,timeZone:void 0}}function Re(r=20){if(E)if(be||(be=(U?document.querySelector(U):b==null?void 0:b.querySelector('input[type="submit"], button[type="submit"], button:not([type="button"]):not([type="reset"])'))||b),be){const c=parseInt(K,10)||12,g=be.getBoundingClientRect(),A=E.getBoundingClientRect(),F=document.documentElement.clientHeight,T=document.documentElement.clientWidth,G=k==="auto"?g.bottom+A.height+c+r>F:k==="top",v=Math.max(r,Math.min(T-r-A.width,g.left+g.width/2-A.width/2));if(G?t(9,E.style.top=`${g.top-(A.height+c)}px`,E):t(9,E.style.top=`${g.bottom+c}px`,E),t(9,E.style.left=`${v}px`,E),E.setAttribute("data-floating",G?"top":"bottom"),ee){const L=ee.getBoundingClientRect();t(10,ee.style.left=g.left-v+g.width/2-L.width/2+"px",ee)}}else x("unable to find floating anchor element")}function st(r){r.auto!==void 0&&(t(0,s=r.auto),s==="onload"&&ne()),r.floatinganchor!==void 0&&t(19,U=r.floatinganchor),r.delay!==void 0&&t(17,M=r.delay),r.floatingoffset!==void 0&&t(20,K=r.floatingoffset),r.floating!==void 0&&lt(r.floating),r.expire!==void 0&&(we(r.expire),t(18,H=r.expire)),r.challenge&&(et(r.challenge),i=r.challenge),r.challengeurl!==void 0&&t(15,a=r.challengeurl),r.debug!==void 0&&t(16,B=!!r.debug),r.hidefooter!==void 0&&t(2,$=!!r.hidefooter),r.hidelogo!==void 0&&t(3,le=!!r.hidelogo),r.maxnumber!==void 0&&t(21,p=+r.maxnumber),r.mockerror!==void 0&&t(22,I=!!r.mockerror),r.name!==void 0&&t(4,X=r.name),r.refetchonexpire!==void 0&&t(23,R=!!r.refetchonexpire),r.spamfilter!==void 0&&t(24,y=typeof r.spamfilter=="object"?r.spamfilter:!!r.spamfilter),r.strings&&t(35,l=r.strings),r.test!==void 0&&t(25,w=typeof r.test=="number"?r.test:!!r.test),r.verifyurl!==void 0&&t(26,Q=r.verifyurl),r.workers!==void 0&&t(27,ue=+r.workers),r.workerurl!==void 0&&t(28,me=r.workerurl)}function _e(r=m.UNVERIFIED,c=null){Y&&(clearTimeout(Y),Y=null),t(8,J=!1),t(11,Ie=c),t(6,te=null),t(7,N=r)}async function ne(){return _e(m.VERIFYING),await new Promise(r=>setTimeout(r,M||0)),Ut().then(r=>(et(r),x("challenge",r),Wt(r))).then(({data:r,solution:c})=>{if(x("solution",c),(c==null?void 0:c.number)!==void 0){if(Q)return Jt(Qe(r,c));t(6,te=Qe(r,c)),x("payload",te)}else throw x("Unable to find a solution. Ensure that the 'maxnumber' attribute is greater than the randomly generated number."),new Error("Unexpected result returned.")}).then(()=>{yt().then(()=>{t(7,N=m.VERIFIED),t(8,J=!0),x("verified"),Ce("verified",{payload:te})})}).catch(r=>{x(r),t(7,N=m.ERROR),t(8,J=!1),t(11,Ie=r.message)})}function Kt(){J=this.checked,t(8,J)}function Qt(r){de[r?"unshift":"push"](()=>{ee=r,t(10,ee)})}function en(r){de[r?"unshift":"push"](()=>{E=r,t(9,E)})}return n.$$set=r=>{"auto"in r&&t(0,s=r.auto),"blockspam"in r&&t(29,u=r.blockspam),"challengeurl"in r&&t(15,a=r.challengeurl),"challengejson"in r&&t(30,h=r.challengejson),"debug"in r&&t(16,B=r.debug),"delay"in r&&t(17,M=r.delay),"expire"in r&&t(18,H=r.expire),"floating"in r&&t(1,k=r.floating),"floatinganchor"in r&&t(19,U=r.floatinganchor),"floatingoffset"in r&&t(20,K=r.floatingoffset),"hidefooter"in r&&t(2,$=r.hidefooter),"hidelogo"in r&&t(3,le=r.hidelogo),"name"in r&&t(4,X=r.name),"formfieldname"in r&&t(5,V=r.formfieldname),"maxnumber"in r&&t(21,p=r.maxnumber),"mockerror"in r&&t(22,I=r.mockerror),"refetchonexpire"in r&&t(23,R=r.refetchonexpire),"spamfilter"in r&&t(24,y=r.spamfilter),"strings"in r&&t(31,d=r.strings),"test"in r&&t(25,w=r.test),"verifyurl"in r&&t(26,Q=r.verifyurl),"workers"in r&&t(27,ue=r.workers),"workerurl"in r&&t(28,me=r.workerurl)},n.$$.update=()=>{n.$$.dirty[0]&1073741824&&(i=h?Ye(h):void 0),n.$$.dirty[1]&1&&t(35,l=d?Ye(d):{}),n.$$.dirty[1]&16&&t(12,o={ariaLinkLabel:We,error:"Verification failed. Try again later.",expired:"Work timed out. Please try again.",footer:`Protected by <a href="${qe}" target="_blank" aria-label="${l.ariaLinkLabel||We}">PoWCHA</a>`,label:"I'm not a bad robot",verified:"You're good to go! 🎉",verifying:"Working... ⚙️",waitAlert:"Still working... Please wait.",...l}),n.$$.dirty[0]&192&&Ce("statechange",{payload:te,state:N}),n.$$.dirty[0]&128&&Gt()},[s,k,$,le,X,V,te,N,J,E,ee,Ie,o,Yt,it,a,B,M,H,U,K,p,I,R,y,w,Q,ue,me,u,h,d,st,_e,ne,l,Kt,Qt,en]}class Ge extends At{constructor(e){super(),It(this,e,Bt,Vt,ut,{auto:0,blockspam:29,challengeurl:15,challengejson:30,debug:16,delay:17,expire:18,floating:1,floatinganchor:19,floatingoffset:20,hidefooter:2,hidelogo:3,name:4,formfieldname:5,maxnumber:21,mockerror:22,refetchonexpire:23,spamfilter:24,strings:31,test:25,verifyurl:26,workers:27,workerurl:28,configure:32,reset:33,verify:34},null,[-1,-1,-1])}get auto(){return this.$$.ctx[0]}set auto(e){this.$$set({auto:e}),_()}get blockspam(){return this.$$.ctx[29]}set blockspam(e){this.$$set({blockspam:e}),_()}get challengeurl(){return this.$$.ctx[15]}set challengeurl(e){this.$$set({challengeurl:e}),_()}get challengejson(){return this.$$.ctx[30]}set challengejson(e){this.$$set({challengejson:e}),_()}get debug(){return this.$$.ctx[16]}set debug(e){this.$$set({debug:e}),_()}get delay(){return this.$$.ctx[17]}set delay(e){this.$$set({delay:e}),_()}get expire(){return this.$$.ctx[18]}set expire(e){this.$$set({expire:e}),_()}get floating(){return this.$$.ctx[1]}set floating(e){this.$$set({floating:e}),_()}get floatinganchor(){return this.$$.ctx[19]}set floatinganchor(e){this.$$set({floatinganchor:e}),_()}get floatingoffset(){return this.$$.ctx[20]}set floatingoffset(e){this.$$set({floatingoffset:e}),_()}get hidefooter(){return this.$$.ctx[2]}set hidefooter(e){this.$$set({hidefooter:e}),_()}get hidelogo(){return this.$$.ctx[3]}set hidelogo(e){this.$$set({hidelogo:e}),_()}get name(){return this.$$.ctx[4]}set name(e){this.$$set({name:e}),_()}get formfieldname(){return this.$$.ctx[5]}set formfieldname(e){this.$$set({formfieldname:e}),_()}get maxnumber(){return this.$$.ctx[21]}set maxnumber(e){this.$$set({maxnumber:e}),_()}get mockerror(){return this.$$.ctx[22]}set mockerror(e){this.$$set({mockerror:e}),_()}get refetchonexpire(){return this.$$.ctx[23]}set refetchonexpire(e){this.$$set({refetchonexpire:e}),_()}get spamfilter(){return this.$$.ctx[24]}set spamfilter(e){this.$$set({spamfilter:e}),_()}get strings(){return this.$$.ctx[31]}set strings(e){this.$$set({strings:e}),_()}get test(){return this.$$.ctx[25]}set test(e){this.$$set({test:e}),_()}get verifyurl(){return this.$$.ctx[26]}set verifyurl(e){this.$$set({verifyurl:e}),_()}get workers(){return this.$$.ctx[27]}set workers(e){this.$$set({workers:e}),_()}get workerurl(){return this.$$.ctx[28]}set workerurl(e){this.$$set({workerurl:e}),_()}get configure(){return this.$$.ctx[32]}get reset(){return this.$$.ctx[33]}get verify(){return this.$$.ctx[34]}}customElements.define("powcha-widget",Rt(Ge,{auto:{},blockspam:{},challengeurl:{},challengejson:{},debug:{type:"Boolean"},delay:{},expire:{},floating:{},floatinganchor:{},floatingoffset:{},hidefooter:{type:"Boolean"},hidelogo:{type:"Boolean"},name:{},formfieldname:{},maxnumber:{},mockerror:{type:"Boolean"},refetchonexpire:{type:"Boolean"},spamfilter:{type:"Boolean"},strings:{},test:{type:"Boolean"},verifyurl:{},workers:{},workerurl:{}},[],["configure","reset","verify"],!1)),globalThis.createPoWCHAWorker=n=>new Worker(new URL(n||"./worker.js",typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:P&&P.src||new URL("powcha-web.umd.cjs",document.baseURI).href)),O.Altcha=Ge,Object.defineProperty(O,Symbol.toStringTag,{value:"Module"})});
